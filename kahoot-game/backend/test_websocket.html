<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ§ª WebSocket æ¸¬è©¦é é¢</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: white;
        }
        
        .container {
            background: rgba(255,255,255,0.1);
            padding: 30px;
            border-radius: 20px;
            backdrop-filter: blur(10px);
        }
        
        h1 {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .section {
            background: rgba(255,255,255,0.1);
            padding: 20px;
            margin: 20px 0;
            border-radius: 15px;
            border-left: 5px solid #4CAF50;
        }
        
        .status {
            padding: 10px;
            border-radius: 10px;
            margin: 10px 0;
            font-family: monospace;
        }
        
        .connected { background: rgba(76, 175, 80, 0.3); }
        .disconnected { background: rgba(244, 67, 54, 0.3); }
        .message { background: rgba(33, 150, 243, 0.3); }
        
        button {
            background: linear-gradient(45deg, #4CAF50, #45a049);
            color: white;
            border: none;
            padding: 10px 20px;
            margin: 5px;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }
        
        button:disabled {
            background: #666;
            cursor: not-allowed;
        }
        
        input, textarea {
            width: 100%;
            padding: 10px;
            margin: 5px 0;
            border: none;
            border-radius: 10px;
            background: rgba(255,255,255,0.2);
            color: white;
            font-size: 14px;
        }
        
        input::placeholder, textarea::placeholder {
            color: rgba(255,255,255,0.7);
        }
        
        .logs {
            height: 300px;
            overflow-y: auto;
            background: rgba(0,0,0,0.3);
            padding: 15px;
            border-radius: 10px;
            font-family: monospace;
            font-size: 12px;
        }
        
        .grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        
        @media (max-width: 768px) {
            .grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ§ª Ricky éŠæˆ²å°èˆ– WebSocket æ¸¬è©¦</h1>
        
        <div class="section">
            <h3>ğŸ“¡ é€£ç·šç‹€æ…‹</h3>
            <div id="connectionStatus" class="status disconnected">
                ğŸ”´ æœªé€£ç·š
            </div>
            
            <input type="text" id="wsUrl" value="ws://localhost:8080/ws" placeholder="WebSocket URL">
            <button id="connectBtn" onclick="connect()">é€£ç·š</button>
            <button id="disconnectBtn" onclick="disconnect()" disabled>æ–·ç·š</button>
        </div>
        
        <div class="grid">
            <div class="section">
                <h3>ğŸ  æˆ¿é–“æ“ä½œ</h3>
                
                <h4>å‰µå»ºæˆ¿é–“</h4>
                <input type="text" id="hostName" value="æ¸¬è©¦ä¸»æŒäºº" placeholder="ä¸»æŒäººåç¨±">
                <input type="number" id="totalQuestions" value="5" placeholder="ç¸½é¡Œæ•¸">
                <input type="number" id="questionTime" value="30" placeholder="ç­”é¡Œæ™‚é–“(ç§’)">
                <button onclick="createRoom()">å‰µå»ºæˆ¿é–“</button>
                
                <h4>åŠ å…¥æˆ¿é–“</h4>
                <input type="text" id="roomId" placeholder="æˆ¿é–“ID (6ä½ä»£ç¢¼)">
                <input type="text" id="playerName" value="æ¸¬è©¦ç©å®¶" placeholder="ç©å®¶æš±ç¨±">
                <button onclick="joinRoom()">åŠ å…¥æˆ¿é–“</button>
                
                <h4>å…¶ä»–æ“ä½œ</h4>
                <button onclick="startGame()">é–‹å§‹éŠæˆ²</button>
                <button onclick="leaveRoom()">é›¢é–‹æˆ¿é–“</button>
                <button onclick="sendPing()">ç™¼é€ Ping</button>
            </div>
            
            <div class="section">
                <h3>ğŸ“ è‡ªå®šç¾©è¨Šæ¯</h3>
                <textarea id="customMessage" rows="8" placeholder='ç¯„ä¾‹ JSON:
{
  "type": "JOIN_ROOM",
  "data": {
    "roomId": "ABC123",
    "playerName": "ç©å®¶1"
  }
}'></textarea>
                <button onclick="sendCustomMessage()">ç™¼é€è‡ªå®šç¾©è¨Šæ¯</button>
                
                <h4>å¿«é€Ÿæ¸¬è©¦</h4>
                <button onclick="runQuickTest()">ğŸš€ å¿«é€Ÿæ¸¬è©¦æµç¨‹</button>
            </div>
        </div>
        
        <div class="section">
            <h3>ğŸ“‹ è¨Šæ¯æ—¥èªŒ</h3>
            <button onclick="clearLogs()">æ¸…é™¤æ—¥èªŒ</button>
            <div id="logs" class="logs"></div>
        </div>
    </div>

    <script>
        let ws = null;
        let currentRoomId = null;
        
        function log(message, type = 'info') {
            const logs = document.getElementById('logs');
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = document.createElement('div');
            logEntry.innerHTML = `<span style="color: #888">[${timestamp}]</span> ${message}`;
            logs.appendChild(logEntry);
            logs.scrollTop = logs.scrollHeight;
        }
        
        function connect() {
            const url = document.getElementById('wsUrl').value;
            
            try {
                ws = new WebSocket(url);
                
                ws.onopen = function() {
                    document.getElementById('connectionStatus').className = 'status connected';
                    document.getElementById('connectionStatus').innerHTML = 'ğŸŸ¢ å·²é€£ç·š';
                    document.getElementById('connectBtn').disabled = true;
                    document.getElementById('disconnectBtn').disabled = false;
                    log('âœ… WebSocket é€£ç·šæˆåŠŸ', 'success');
                };
                
                ws.onmessage = function(event) {
                    const message = JSON.parse(event.data);
                    log(`ğŸ“¨ æ”¶åˆ°è¨Šæ¯: ${JSON.stringify(message, null, 2)}`, 'message');
                    
                    // è™•ç†ç‰¹å®šè¨Šæ¯
                    if (message.type === 'ROOM_CREATED') {
                        currentRoomId = message.data.roomId;
                        document.getElementById('roomId').value = currentRoomId;
                        log(`ğŸ  æˆ¿é–“å‰µå»ºæˆåŠŸï¼ŒID: ${currentRoomId}`, 'success');
                    }
                };
                
                ws.onclose = function() {
                    document.getElementById('connectionStatus').className = 'status disconnected';
                    document.getElementById('connectionStatus').innerHTML = 'ğŸ”´ å·²æ–·ç·š';
                    document.getElementById('connectBtn').disabled = false;
                    document.getElementById('disconnectBtn').disabled = true;
                    log('âŒ WebSocket é€£ç·šé—œé–‰', 'error');
                };
                
                ws.onerror = function(error) {
                    log(`ğŸš¨ WebSocket éŒ¯èª¤: ${error}`, 'error');
                };
                
            } catch (error) {
                log(`âŒ é€£ç·šå¤±æ•—: ${error}`, 'error');
            }
        }
        
        function disconnect() {
            if (ws) {
                ws.close();
            }
        }
        
        function sendMessage(message) {
            if (ws && ws.readyState === WebSocket.OPEN) {
                ws.send(JSON.stringify(message));
                log(`ğŸ“¤ ç™¼é€è¨Šæ¯: ${JSON.stringify(message, null, 2)}`, 'info');
            } else {
                log('âŒ WebSocket æœªé€£ç·š', 'error');
            }
        }
        
        function createRoom() {
            const message = {
                type: 'CREATE_ROOM',
                data: {
                    hostName: document.getElementById('hostName').value,
                    totalQuestions: parseInt(document.getElementById('totalQuestions').value),
                    questionTimeLimit: parseInt(document.getElementById('questionTime').value)
                }
            };
            sendMessage(message);
        }
        
        function joinRoom() {
            const message = {
                type: 'JOIN_ROOM',
                data: {
                    roomId: document.getElementById('roomId').value,
                    playerName: document.getElementById('playerName').value
                }
            };
            sendMessage(message);
        }
        
        function startGame() {
            const message = {
                type: 'START_GAME',
                data: {
                    roomId: currentRoomId || document.getElementById('roomId').value
                }
            };
            sendMessage(message);
        }
        
        function leaveRoom() {
            const message = {
                type: 'LEAVE_ROOM',
                data: {}
            };
            sendMessage(message);
        }
        
        function sendPing() {
            const message = {
                type: 'PING',
                data: {}
            };
            sendMessage(message);
        }
        
        function sendCustomMessage() {
            try {
                const message = JSON.parse(document.getElementById('customMessage').value);
                sendMessage(message);
            } catch (error) {
                log(`âŒ JSON æ ¼å¼éŒ¯èª¤: ${error}`, 'error');
            }
        }
        
        function runQuickTest() {
            log('ğŸš€ é–‹å§‹å¿«é€Ÿæ¸¬è©¦æµç¨‹...', 'info');
            
            setTimeout(() => {
                log('1. å‰µå»ºæˆ¿é–“...', 'info');
                createRoom();
            }, 1000);
            
            setTimeout(() => {
                log('2. ç™¼é€ Ping...', 'info');
                sendPing();
            }, 3000);
            
            setTimeout(() => {
                log('3. å˜—è©¦åŠ å…¥è‡ªå·±çš„æˆ¿é–“...', 'info');
                document.getElementById('playerName').value = 'æ¸¬è©¦ç©å®¶2';
                joinRoom();
            }, 5000);
        }
        
        function clearLogs() {
            document.getElementById('logs').innerHTML = '';
        }
        
        // é é¢è¼‰å…¥æ™‚é¡¯ç¤ºèªªæ˜
        window.onload = function() {
            log('ğŸ® WebSocket æ¸¬è©¦é é¢å·²è¼‰å…¥', 'info');
            log('ğŸ“ è«‹å…ˆé»æ“Š"é€£ç·š"æŒ‰éˆ•å»ºç«‹ WebSocket é€£ç·š', 'info');
            log('ğŸ  ç„¶å¾Œå¯ä»¥æ¸¬è©¦å‰µå»ºæˆ¿é–“ã€åŠ å…¥æˆ¿é–“ç­‰åŠŸèƒ½', 'info');
            log('ğŸš€ æˆ–ç›´æ¥é»æ“Š"å¿«é€Ÿæ¸¬è©¦æµç¨‹"é€²è¡Œè‡ªå‹•æ¸¬è©¦', 'info');
        };
    </script>
</body>
</html>